{% extends 'layout.html.twig' %}

{% do script(['libs/vue.js', 'libs/jquery-countdown.js', 'app/js/goods/show/index.js', 'app/js/courseset/show/tasks/index.js']) %}

{% block title %}{{ goods.title|raw }} - {{ parent() }}{% endblock %}
{% block full_content %}
  {% set enable_anti_brush_captcha = setting('ugc_content_audit.enable_anti_brush_captcha')|default(1) %}
  <input type="hidden" name="enable_anti_brush_captcha" value="{{enable_anti_brush_captcha}}">
  {% if enable_anti_brush_captcha == 1 and app.user.isLogin()|default(false) %}
    <div class="js-mask" style="position:fixed; left:0px; top:0px; background:rgba(0, 0, 0, 0.4); width:100%; height:100%; filter:alpha(opacity=60); opacity:0.6;display:none; z-index:100;"></div>
    <div class="form-group cd-mb32 js-drag-jigsaw" style="width: 338px; height: 219px; position:fixed; z-index:101; display: none; background: white;">
      {% include 'common/drag.html.twig' with { auth: true, showLabel: 0 } %}
    </div>
  {% endif %}
  <div id="show-product-page" class="" style=""
       data-goods="{{ goods|json_encode }}"
       data-components-data="{{ goodsComponents|json_encode }}"
       data-current-user-id="{{ app.user.id|default(null) }}"
       data-target-id="{{ app.request.query.get('targetId')|default(null) }}"
       data-is-user-login="{{ app.user.isLogin()|default(0) }}"
       data-current-url="{{ url('goods_show', { id: app.request.get('id')}) }}"
       data-goods-setting="{{ setting('goods_setting', {})|json_encode }}"
       data-drp-recruit-switch="{{ setting('drp.recruitSwitch')|default() }}"
       data-ugc-review-setting="{{ setting('ugc_review', {})|json_encode }}"
       data-vip-enabled="{{ setting('vip.enabled')|default(1) }}"
  ></div>
  <div class="js-hidden-i18n" style="display:none;">
    {
    "i18nChapterName": "{{course_chapter_alias('chapter')|trans}}",
    "i18nUnitName": "{{course_chapter_alias('part')|trans}}",
    "i18nLessonName": "{{'site.data.lesson'|trans}}",
    "i18nTaskName":"{{ course_chapter_alias('task')|trans}}"
    }
  </div>
  <div class="js-hidden-activity-metas" style="display:none;">
    {
    {% set allMetas = activity_meta() %}
    {% for key, item in allMetas %}
      {% if not loop.first %}
        ,
      {% endif %}

      "{{key}}": {
      "icon": "{{item.icon}}",
      "name": "{{item.name}}"
      }
    {% endfor %}
    }
  </div>

  <div class="js-hidden-current-timestamp" style="display:none;">{{ date().timestamp }}</div>

  {%
    include 'common/weixin-share.html.twig' with {
      'title': goods.title,
      'desc': goods.summary|striptags|purify_and_trim_html,
      'link': app.request.uri,
      'imgUrl': fileurl(goods.images.large|default(),'course.png'),
    }
  %}
{% endblock %}
